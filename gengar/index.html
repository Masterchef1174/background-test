<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gengar Clock</title>

  <!-- Widget / iframe safe CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src * data: blob: 'unsafe-inline' 'unsafe-eval';
          img-src * data: blob:;
          media-src * data: blob:;
          style-src * 'unsafe-inline';
          script-src * 'unsafe-inline' 'unsafe-eval';
          frame-ancestors *;
        ">

  <style>
    :root{
      --time-size: 86px;
      --date-size: 24px;
      --time-weight: 700;
      --date-weight: 600;
      --glow: 18px;

      --x: 8%;
      --y: 12%;

      --text: rgba(255,255,255,.96);
      --shadow: rgba(0,0,0,.55);
      --stroke: rgba(0,0,0,.35);
      --stroke-w: 1.2px;

      --plate: rgba(0,0,0,.10);
      --plate-border: rgba(255,255,255,.10);
      --plate-radius: 22px;
      --plate-pad-x: 18px;
      --plate-pad-y: 14px;

      --video-dim: .98;
      --video-sat: 1.05;
      --video-contrast: 1.05;
      --video-blur: 0px;
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: #000;
    }

    #widget {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: #000;
    }

    /* PURE GRADIENT FALLBACK (always visible) */
    .stage{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

      background:
        radial-gradient(900px 700px at 25% 18%, #3a1b52 0%, transparent 55%),
        radial-gradient(600px 500px at 70% 65%, #1a0f2e 0%, transparent 60%),
        linear-gradient(180deg, #0b0612 0%, #000 100%);
    }

    video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      filter: brightness(var(--video-dim)) saturate(var(--video-sat))
              contrast(var(--video-contrast)) blur(var(--video-blur));
      transform: scale(1.01);
      z-index: 0;
    }

    .video-hidden{ display:none !important; }

    .hud{
      position:absolute;
      left:var(--x);
      top:var(--y);
      z-index: 2;

      display:flex;
      flex-direction:column;
      gap:8px;

      padding: var(--plate-pad-y) var(--plate-pad-x);
      border-radius: var(--plate-radius);
      background: var(--plate);
      border: 1px solid var(--plate-border);

      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      user-select:none;
    }

    .time{
      font-size:var(--time-size);
      font-weight:var(--time-weight);
      line-height:1;
      letter-spacing:-0.02em;
      color:var(--text);
      text-shadow:
        0 3px 18px var(--shadow),
        0 0 var(--glow) rgba(255,255,255,.14);
      -webkit-text-stroke: var(--stroke-w) var(--stroke);
    }

    .date{
      font-size:var(--date-size);
      font-weight:var(--date-weight);
      letter-spacing:0.02em;
      color:rgba(255,255,255,.92);
      text-shadow: 0 2px 14px var(--shadow);
      -webkit-text-stroke: 0.6px rgba(0,0,0,.25);
    }

    .badge{
      position:absolute;
      right:12px;
      bottom:12px;
      z-index: 3;
      font-size:12px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.18);
      color:rgba(255,255,255,.9);
      display:none;
    }

    @supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
      .hud { background: rgba(0,0,0,.35); }
    }
  </style>
</head>

<body>
  <div id="widget">
    <div class="stage">

      <video id="bg" autoplay muted loop playsinline preload="auto">
        <source src="https://masterchef1174.github.io/background-test/gengar.mp4" type="video/mp4" />
      </video>

      <div class="hud" id="hud">
        <div class="time" id="time">--:--</div>
        <div class="date" id="date">---</div>
      </div>

      <div class="badge" id="badge"></div>
    </div>
  </div>

  <script>
    const elTime = document.getElementById('time');
    const elDate = document.getElementById('date');
    const bg = document.getElementById('bg');
    const badge = document.getElementById('badge');

    function showBadge(msg){
      badge.textContent = msg;
      badge.style.display = 'block';
    }
    function hideBadge(){ badge.style.display = 'none'; }

    function formatTime(d){
      try {
        return new Intl.DateTimeFormat(undefined,{hour:'numeric',minute:'2-digit'}).format(d);
      } catch {
        let h=d.getHours(), m=String(d.getMinutes()).padStart(2,'0');
        const a=h>=12?'PM':'AM'; h=h%12||12;
        return `${h}:${m} ${a}`;
      }
    }

    function formatDate(d){
      try {
        return new Intl.DateTimeFormat(undefined,{weekday:'long',month:'long',day:'numeric'}).format(d);
      } catch {
        return d.toDateString();
      }
    }

    function tick(){
      const now=new Date();
      elTime.textContent=formatTime(now);
      elDate.textContent=formatDate(now);
    }
    tick();
    setInterval(tick,1000);

    function fallback(reason){
      bg.classList.add('video-hidden');
      showBadge(reason);
    }

    bg.addEventListener('error',()=>fallback('Video failed'));
    bg.addEventListener('abort',()=>fallback('Video aborted'));
    bg.addEventListener('playing',hideBadge);

    async function tryPlay(){
      try{ await bg.play(); }
      catch{ fallback('Autoplay blocked'); }
    }

    window.addEventListener('load',()=>{
      tryPlay();
      setTimeout(tryPlay,800);
    });

    document.getElementById('hud').addEventListener('click',()=>{
      const r=document.documentElement;
      const off='rgba(0, 0, 0, 0)';
      const on='rgba(0,0,0,.10)';
      const cur=getComputedStyle(r).getPropertyValue('--plate').trim();
      const t=cur===off;
      r.style.setProperty('--plate',t?on:off);
      r.style.setProperty('--plate-border',t?'rgba(255,255,255,.10)':'rgba(255,255,255,0)');
      r.style.setProperty('--plate-pad-x',t?'18px':'0px');
      r.style.setProperty('--plate-pad-y',t?'14px':'0px');
    },{passive:true});
  </script>
</body>
</html>
